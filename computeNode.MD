

# 普通运算节点
普通运算节点同时也是转发节点. 
普通运算节点的经济驱动来自于发给它的运算请求附带的 PostStamp.
它可以获得最大的利益是 RandAlgo 碰撞成功, 它可以进行运算并获得劳动奖励.
如果碰撞不成功, 它至少可以转发给其他的运算节点收一笔过桥费.
每次转发后, 因为收取了过桥费, PostStamp 的余额不断减少. 当余额不足以支撑继续传递的时候该节点就不会继续传递. 该请求被 Drop. 这样的设计是避免 Spam. 让运算节点有利可图. 

对于客户节点, 如果附带的 PostStamp 不够多, 或者传输的过程很长但是一直没有遇到足够的运算节点 RandAlgo 碰撞成功. 那么有一定的可能性发生钱花光了但是运算没有完成. 所以预缴足够数量的邮费是需要的. 没有用完的还会退回.

## Steps
### 检查 PostStamp 和此前的过桥费收费记录
普通运算节点的收入来自于过桥费或者计算费. 所以他们有意愿来检查是否能够挣到钱. 
检查的内容包括
- 请求附带的 PostStamp 余额足够支付自己的过桥费. 如果不足, 就放弃. 终止传输. 计算余额的方法就是最初的总 Poststamp 减去此前经过的节点减去的过桥费. 
- 如果余额足够. 那就顺序检查此前的每一笔过桥费是否有多收费. 根据共识规则. 如果这条链路上的过桥费收费记录中存在某一个节点多收费, 而且后面的节点没有当时指出, 那么包括那个多收费的节点在内的节点以及其后的所有节点都白干活. 而且还可能面临罚金.
- 如果顺序检查没有发现多收费情况. 全部合理合法.那么进行下一步. 

** 关于过桥费是否最终挣得到还取决于这个分支最终十分被审计节点认同. 所以这里有一个概率和运气成分. 详细见过桥费一问**

### 检查签名信息保证请求来源可靠
检查签名, 确认该请求的确来自申明的发送方. 如果不符合, drop 掉. 因为最终也是拿不到钱的.
如果签名正确, 格式也是符合要求的, 进行下一步.
### 检查 RandAlgo 的哈希碰撞是否自己有权进行运算
如果hash 碰撞成功. 而且检查当前已经完成拜占庭必须节点数还没有达到满足. 那么就幸运地进行运算. 如果条件不满足(无论是哈希碰撞失败, 还是已经有足够多的节点完成拜占庭最低数要求)那么就进入转发流程
### 计算流程
#### 下载最新的状态区块, 并检查块高度和 hash 匹配. 
如果最新区块就是请求附带的状态块, 那么检查就算通过.如果不是, 那么检查最新区块的父亲, 父亲的父亲等追溯前辈.如果根据块高度查出来的前辈块的hash 和客户请求的 hash 不匹配. 那么请求可能是来自一个分支. 这个计算无法进行下去. 转入转发流程.
#### 下载函数代码. 检查 hash 正确. (不太可能不正确, 毕竟是 IPFS 做的)
#### 运行函数. 设定计算资源上限如果超过 PostStamp 的余额就停止.放弃
#### 运行结果形成一个结果请求. 附上余额 PostStamp. 发送给当前的审计节点. 进入审计申请流程
### 转发流程
这个运算节点无权进行计算处理, 就只能转发. 虽然挣得少一些, 但是也算是没有白干活
转发就是把自己扣过桥费这个交易附在原始的客户请求之后. 然后把整个请求发给自己的邻居 Carrier 节点. 让他们或者处理或者也转发. 
### 审计申请流程
将原始的请求加上自己的运算结果, 在加上自己扣除计算费的交易收据形成一个新的请求包. 直接转发给目前已知的审计节点. 不要继续转发给普通计算节点了.
